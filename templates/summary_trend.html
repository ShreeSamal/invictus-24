{% extends "layout.html" %}

{% block body %}
<div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
<style>
    .canvasjs-chart-credit{
        display: none;
    }
</style>
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-content">

                <!-- ***** Featured Games Start ***** -->
                <div class="row">
                    <div class="col-lg-8" style="width: 69%">
                        <div class="featured-games header-text">
                            <div class="heading-section">
                                <h4><em>Summary</em> of the Trending Video</h4>
                            </div>
                            <div class="youtube-video">
                                <iframe style="border-radius: 7px;" width="100%" height="400px"
                                    src="{{video_details_lst['embed_link']}}" frameborder="0">
                                </iframe>
                            </div>
                            <p class="video-title"
                                style="color: white; font-size: 1.7em; font-weight: 600; margin-top: 16px">
                                {{video_details_lst['title']}}
                            </p>
                            <ul class="like_view"
                                style="margin-top: 10px; float: none; display: flex; gap: 40px; color: white; font-size: 1.2em">

                                {% if video_details_lst['view_count']|length < 4 %} {% set
                                    view_count=video_details_lst['view_count'] %} <li><i class="fa-solid fa-eye"
                                        style="color: yellow;"></i> &nbsp;{{ view_count }}</li>
                                    {% elif 6 > video_details_lst['view_count']|length > 3 %}
                                    {% set view_count =
                                    video_details_lst['view_count'][:video_details_lst['view_count']|length-3] + " K+"%}
                                    <li><i class="fa-solid fa-eye" style="color: yellow;"></i> &nbsp;{{ view_count }}
                                    </li>
                                    {% else %}
                                    {% set view_count =
                                    video_details_lst['view_count'][:video_details_lst['view_count']|length-5] + " L+"%}

                                    <li><i class="fa-solid fa-eye" style="color: yellow;"></i> &nbsp;{{ view_count }}
                                    </li>

                                    {% endif %}

                                    {% if video_details_lst['like_count']|length < 4 %} {% set
                                        like_count=video_details_lst['like_count'] %} <li><i
                                            class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> &nbsp;{{
                                        like_count }}</li>
                                        {% elif 6 > video_details_lst['like_count']|length > 3 %}
                                        {% set like_count =
                                        video_details_lst['like_count'][:video_details_lst['like_count']|length-3] + "
                                        K+"%}
                                        <li><i class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> &nbsp;{{
                                            like_count }}</li>
                                        {% else %}
                                        {% set like_count =
                                        video_details_lst['like_count'][:video_details_lst['like_count']|length-5] + "
                                        L+"%}

                                        <li><i class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> {{
                                            like_count }}</li>

                                        {% endif %}

                                        {% if video_details_lst['comments_count'] == 0 %}
                                        <li><i class="fa-solid fa-message" style="color: purple;"></i></i> Not Available
                                        </li>
                                        {% elif video_details_lst['comments_count']|length < 4 %} {% set
                                            comments_count=video_details_lst['comments_count'] %} <li><i
                                                class="fa-solid fa-message" style="color: purple;"></i> {{
                                            comments_count }}</li>
                                            {% elif 6 > video_details_lst['comments_count']|length > 3 %}
                                            {% set comments_count =
                                            video_details_lst['comments_count'][:video_details_lst['comments_count']|length-3]
                                            + " K+"%}
                                            <li><i class="fa-solid fa-message" style="color: purple;"></i></i> {{
                                                comments_count }}</li>
                                            {% else %}
                                            {% set comments_count =
                                            video_details_lst['comments_count'][:video_details_lst['comments_count']|length-5]
                                            + " L+"%}

                                            <li><i class="fa-solid fa-message" style="color: purple;"></i></i> {{
                                                comments_count }}</li>

                                            {% endif %}


                            </ul>

                        </div>
                    </div>
                    <div class="col-lg-4" style="width: 29%">
                        <div class="top-downloaded" style="height: 100%;">
                            <div class="heading-section">
                                <h4 style="font-size: 1.3em;"><em>Similar</em> Videos</h4>
                            </div>
                            <ul style="height: 490px; overflow: auto">

                                <li>
                                    {% for key, value in recommended_video.items() %}
                                    <iframe style="border-radius: 7px;" width="100%" src="{{value['embed_link']}}"
                                        frameborder="0">
                                    </iframe>
                                    <p class="vid-download-title" style="margin-top: 10px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
                                    text-overflow: ellipsis; line-clamp: 2;">{{value['title']}}
                                    </p>

                                    <ul class="like_view"
                                        style="margin-top: 10px; float: none; display: flex; justify-content: space-between; color: white;">

                                        {% if value['view_count']|length < 4 %} {% set view_count=value['view_count'] %}
                                            <li><i class="fa-solid fa-eye" style="color: yellow;"></i> &nbsp;{{
                                            view_count }}
                                </li>
                                {% elif 6 > value['view_count']|length > 3 %}
                                {% set view_count = value['view_count'][:value['view_count']|length-3] + " K+"%}
                                <li><i class="fa-solid fa-eye" style="color: yellow;"></i> &nbsp;{{ view_count }}</li>
                                {% else %}
                                {% set view_count = value['view_count'][:value['view_count']|length-5] + " L+"%}

                                <li><i class="fa-solid fa-eye" style="color: yellow;"></i> &nbsp;{{ view_count }}</li>

                                {% endif %}

                                {% if value['like_count']|length < 4 %} {% set like_count=value['like_count'] %} <li><i
                                        class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> &nbsp;{{ like_count
                                    }}</li>
                                    {% elif 6 > value['like_count']|length > 3 %}
                                    {% set like_count = value['like_count'][:value['like_count']|length-3] + " K+"%}
                                    <li><i class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> &nbsp;{{
                                        like_count }}</li>
                                    {% else %}
                                    {% set like_count = value['like_count'][:value['like_count']|length-5] + " L+"%}

                                    <li><i class="fa-regular fa-thumbs-up" style="color: #ec6090;"></i> {{ like_count }}
                                    </li>

                                    {% endif %}
                            </ul>
                            <div style="margin-top: 10px;">
                                <a href="/summary/{{key}}//{{value['title']}}" class="summary-button"
                                    style="font-size: 0.8em; padding: 3px 15px; background: yellow; color: black; font-weight: 600; border-radius: 5px;">
                                    See Summary
                                </a>
                            </div>

                            <hr width="100%" style="color: white;">
                            {% endfor %}


                            </li>




                            </ul>
                            <!-- <div class="text-button">
                                <a href="profile.html">View All Games</a>
                            </div> -->
                        </div>
                    </div>
                </div>
                <!-- ***** Featured Games End ***** -->

                <!-- ***** Start Stream Start ***** -->
                <div class="start-stream">
                    <div class="col-lg-12">
                        <div class="heading-section">
                            <h4>Summary</h4>
                            <div class="details-wrap" style="display: flex; justify-content: space-between;">
                                <div style="width: fit-content; display: flex; flex-direction: column; gap: 15px">

                                    <div class="text-box"
                                        style=" width: 800px; background-color: #1B1B1B; padding: 20px 14px; height: auto; border-radius: 6px;">
                                        <textarea readonly id="message" rows="12"
                                            style="width: 100%; background: transparent; color: white; border: none; height: 100%; ">Generating Summary...</textarea>
                                    </div>
                                    <div style="width:'fit-content'; display: flex; justify-content: 'start';">
                                        <a id="speak" href="#" class="waves-effect waves-light btn"
                                            style="padding: 6px 15px; border-radius: 5px; background-color: #ff007f; color: white; font-size: 1.2em; font-weight: 600;">Read
                                            Aloud</a>
                                    </div>
                                </div>
                                <div id="chartContainer" style="height: 335px; width: 350px; border-radius: 10px"></div>
                            </div>
                        </div>
                    </div>

                    <style>
                        .canvasjs-chart-credit {
                            display: none;
                        }
                    </style>
                </div>
                <!-- ***** Start Stream End ***** -->
            </div>
        </div>
    </div>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/materialize/0.95.1/js/materialize.min.js"></script>
<script>
    $(function () {
        var msg = null;

        if ('speechSynthesis' in window) {
            speechSynthesis.onvoiceschanged = function () {
                var $voicelist = $('#voices');

                if ($voicelist.find('option').length == 0) {
                    speechSynthesis.getVoices().forEach(function (voice, index) {
                        var $option = $('<option>')
                            .val(index)
                            .html(voice.name + (voice.default ? ' (default)' : ''));

                        $voicelist.append($option);
                    });

                    $voicelist.material_select();
                }
            }

            $('#speak').click(function () {
                if (msg) {
                    speechSynthesis.cancel(); // Stop any ongoing speech synthesis
                }

                var text = $('#message').val();
                msg = new SpeechSynthesisUtterance();
                var voices = window.speechSynthesis.getVoices();

                msg.text = text;

                msg.onend = function (e) {
                    console.log('Finished in ' + event.elapsedTime + ' seconds.');
                };

                speechSynthesis.speak(msg);
            });

            // Stop speech synthesis when the page is closed or refreshed
            $(window).on('beforeunload', function () {
                if (msg) {
                    speechSynthesis.cancel();
                }
            });
        } else {
            console.log("Error");
        }
    });
</script>

<script type="text/javascript">
    window.onload = function () {
      var chart = new CanvasJS.Chart("chartContainer", {
        title: {
          text: "Distribution of Comments in %",
          fontColor: "white",
          fontWeight: "lighter",
        },
        backgroundColor: "#1B1B1B", // Set chart background to transparent
        data: [
          {
            type: "doughnut",
            innerRadius: "60%",
            indexLabelFontColor: "white",
            dataPoints: [
              { y: 10, indexLabel: "Neutral" },
              { y: 50, indexLabel: "Negative" },
              { y: 40, indexLabel: "Positive" },
            ],
          },
        ],
      });
  
      chart.render();
    };
</script>
<script>
    $(document).ready(function () {
        $("#js-preloader").removeClass('loaded');
        var msg = null;
        fetch('/caption/summary/audio_video/{{video_id}}')
        .then(response => response.text())
        .then(data => {
            $("#js-preloader").addClass('loaded');
            $('#message').val(data);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            $("#js-preloader").addClass('loaded');
        });
    });
</script>
<script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.min.js"></script>

  </script>
  <script
    type="text/javascript"
    src="https://cdn.canvasjs.com/canvasjs.min.js"
  ></script>
  
<script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
{% endblock body %}